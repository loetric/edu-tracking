# إصلاح مشكلة تحديث صلاحيات المستخدمين

## المشكلة
عند محاولة تغيير صلاحية مستخدم في صفحة إدارة المستخدمين، يظهر خطأ `403 (Forbidden)` ولا يتم تحديث الصلاحية.

## السبب
RLS policy الحالية تسمح فقط للمستخدم بتحديث ملفه الشخصي (`auth.uid() = id`). نحتاج إلى policy إضافية تسمح للمدير بتحديث أي profile.

## الحل

### 1. تشغيل SQL Script
اذهب إلى Supabase Dashboard → SQL Editor وقم بتشغيل الملف:
```
sql/06_allow_admin_update_profiles.sql
```

هذا الـ script سيضيف policy جديدة تسمح للمديرين بتحديث أي profile.

### 2. التحقق من النتيجة
بعد تشغيل الـ script، يجب أن تتمكن من:
- تحديث صلاحية أي مستخدم (إذا كنت مدير)
- رؤية رسالة تأكيد من النظام (وليس من المتصفح)
- رؤية رسالة نجاح/خطأ من النظام

## ملاحظات
- تأكد من أن المستخدم الحالي لديه صلاحية `admin` في جدول `profiles`
- إذا استمرت المشكلة، تحقق من أن الـ policy تم إنشاؤها بنجاح:
  ```sql
  SELECT * FROM pg_policies WHERE tablename = 'profiles';
  ```

